<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="author" content="Jakub Jagusztyn">

    <title>A tour of Cargo</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section data-markdown>
            ![Cargo Logo](img/cargo_logo.png)
            # A tour of Cargo
            Jakub Jagusztyn
        </section>
        <section>
            <section>
                <h4>What is Cargo?</h4>
                <p class="fragment">Cargo is a build tool/package manager for Rust</h5>
                <p class = "fragment">Like Maven for Java or npm for JS</p>
                <p></p>
            </section>
            <section>
                <h4>What can it do?</h4>
                <ul>
                    <li class="fragment">Initialize a project</li>
                    <li class="fragment">Compile Rust code</li>
                    <li class="fragment">Run Rust applications</li>
                    <li class="fragment">Run tests</li>
                    <li class="fragment">Run benchmarks</li>
                    <li class="fragment">Fetch dependencies from the Internet</li>
                    <li class="fragment">Build packages</li>
                    <li class="fragment">Upload packages to <a href="http://crates.io">crates.io</a></li>
                    <li class="fragment">...and much more</li>
                </ul>
            </section>
            <section>
                <p>Project structure</p>
                <pre><code class="no-highlight" data-trim data-noescape>
                    ├── build.rs
                    ├── Cargo.lock
                    ├── Cargo.toml
                    ├── benches         # benchmarks
                    │   ├── bench1.rs
                    │   └── bench4.rs
                    ├── examples        # code examples
                    │   ├── example1.rs
                    │   └── example2.rs
                    ├── src
                    │   ├── bin         # other executables
                    │   │   ├── bin1.rs
                    │   │   └── bin2.rs
                    │   ├── lib.rs
                    │   └── main.rs
                    └── tests           # integration tests
                        ├── it_test1.rs
                        └── it_test2.rs
                </code></pre>
            </section>
            <section>
                <p>TOML</p>
                <p>Cargo uses <a href="https://github.com/toml-lang/toml">TOML</a> for configuration</p>
                <pre><code class="toml" data-trim data-noescape>
                <span class="fragment"># this is a comment</span>
                <span class="fragment">[package] # this is a table</span>
                <span class="fragment">name = "leftpad" # this is key-value pair(which is a member of [package]</span>
                <span class="fragment">authors = ["JJag"] # the value here is an array</span>
                <span class="fragment">[dependencies]</span>
                <span class="fragment">log = {version = "*", optional = true} # this is inline table</span>
                <span class="fragment">[dependencies.log] # this is equivalent of the line above
                version = "*"
                optional = true
                </span>
                <span class="fragment">[[bin]] # double-brackets mean `bin` is array of tables
                name = "foo"
                path = "src/bin/foo.rs"

                [[bin]]
                name = "bar"
                path = "src/bin/bar.rs"
                </span>

                </code></pre>

            </section>
        </section>
        <section>Let's create a library!</section>
        <section>
            <section>
                <p>First, initialize a project</p>
                <pre class="fragment"><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo new hello</span>
                    <span class="fragment">Created binary (application) `hello` package
                    > </span><span class="fragment">tree hello</span><span class="fragment">
                    hello
                    ├── Cargo.toml
                    └── src
                        └── main.rs
                    </span>
                </code></pre>
            </section>
            <section>
                <div>
                    Cargo.toml
                    <pre><code class="toml" data-trim>
                    [package]
                    name = "hello"
                    version = "0.1.0"
                    authors = ["JJag &lt;jakub.jagusztyn@gmail.com>"]

                    [dependencies]
                </code></pre>
                </div>
                <div class="fragment">
                    src/main.rs
                    <pre><code class="rust" data-trim>
                        fn main() {
                            println!("Hello, world!");
                        }
                </code></pre>
                </div>
            </section>
            <section>
                <p>But we wanted to create a library</p>
            </section>
            <section>
                <p>Initlizing a library project</p>
                <pre><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo new --lib leftpad</span>
                    <span class="fragment">Created library `leftpad` project
                    > </span><span class="fragment">tree leftpad</span><span class="fragment">
                    hello
                    ├── Cargo.toml
                    └── src
                        └── lib.rs
                    </span>
                </code></pre>
                <div class="fragment">
                    <p>src/lib.rs</p>
                    <pre><code class="rust" data-trim data-noescape>
                    #[cfg(test)]
                    mod tests {
                        #[test]
                            fn it_works() {
                            assert_eq!(2 + 2, 4);
                        }
                    }
                </code></pre>
                </div>
            </section>
            <section>
                <p>Let's add implementation</p>
                <pre><code data-trim data-noescape>
                    <span class="fragment" data-fragment-index="6">/// Worst leftpad implementation ever</span>
                    <span class="fragment" data-fragment-index="1">pub fn leftpad(s: &str, to_len: usize) -> String {</span>
                    <span class="fragment" data-fragment-index="2">    let mut s = s.to_string();</span>
                    <span class="fragment" data-fragment-index="3">    while s.chars().count() < to_len {</span>
                    <span class="fragment" data-fragment-index="4">        s.insert(0, ' ');</span>
                    <span class="fragment" data-fragment-index="3">    }</span>
                    <span class="fragment" data-fragment-index="5">    s</span>
                    <span class="fragment" data-fragment-index="1">}</span>
                    </code></pre>
            </section>
            <section>
                <p><code>cargo new</code> summary</p>
                <ul>
                    <li class="fragment"><code>--bin</code>(or no option) to init an executable</li>
                    <li class="fragment"><code>--lib</code> to init a library</li>
                    <li class="fragment">Initializes git repo(unless <code>--vcs none)</code></li>
                    <li class="fragment">Custom templates are not supported(yet)</li>
                </ul>
            </section>
        </section>
        <section>
            <section>
                <p>We have some code, so let's compile it</p>
                <pre class="fragment"><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo build</span>
                    <span class="fragment">
                     Compiling leftpad v0.1.0 (/Users/jakubjagusztyn/Documents/cargo-playground/leftpad)
                      Finished dev [unoptimized + debuginfo] target(s) in 1.04s
                    > </span><span class="fragment"> tree target</span>
                    <span class="fragment">
                        target
                        └── debug
                            ├── deps
                            │   ├── leftpad-ec5d8e1b4e128710.d
                            │   └── libleftpad-ec5d8e1b4e128710.rlib
                            ├── incremental
                            │   └── leftpad-185h2tydnryvy
                            │       ├── s-f6v36pz360-1g90vre-2yojh78r8kjff
                            │       │   ├── 4n49resrahfjvtp7.bc.z
                            │       │   ├── 4n49resrahfjvtp7.o
                            │       │   ├── dep-graph.bin
                            │       │   ├── query-cache.bin
                            │       │   └── work-products.bin
                            │       └── s-f6v36pz360-1g90vre.lock
                            ├── libleftpad.d
                            └── <b>libleftpad.rlib</b>
                    </span>
                </code></pre>
            </section>
            <section>
                    <p><code>cargo build</code> summary</p>
                <ul>
                    <li class="fragment">Compiles your project(and its dependencies)</li>
                    <li class="fragment">For applications, creates appropriate executable</li>
                    <li class="fragment">For libraries, create <code>rlib</code> static library</li>
                    <li class="fragment">By default compiles only <code>src/</code></li>
                    <li class="fragment">Artifacts are placed under <code>target/</code> directory
                    <li class="fragment">By default uses debug profile(no optimizations, enabled debug symbols)
                    </li>
                    <li class="fragment">Use <code>--release</code> to enable compiler optimizations</li>
                </ul>
            </section>
        </section>
        <section>
            <section>
                <p>Let's run it!</p>
                <pre class="fragment"><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo run</span>
                    <span class="fragment">
                        error: a bin target must be available for `cargo run`
                    </span>
                </code></pre>
                <p class="fragment">Run what?</p>
            </section>
            <section>
                <p>A CLI tool!</p>
                <div>
                    <pre><code class="rust" data-trim data-noescape>
                        <span class="fragment" data-fragment-index="1">/// src/bin/leftpad.rs</span>
                        <span class="fragment" data-fragment-index="1"></span>
                        <span class="fragment" data-fragment-index="1">use std::env;</span>
                        <span class="fragment" data-fragment-index="1"></span>
                        <span class="fragment" data-fragment-index="1">fn main() {</span>
                        <span class="fragment" data-fragment-index="2">    let args: Vec&lt;String> = env::args().collect();</span>
                        <span class="fragment" data-fragment-index="3">    let s = &args[1];</span>
                        <span class="fragment" data-fragment-index="4">    let n = args[2].parse().unwrap();</span>
                        <span class="fragment" data-fragment-index="5">    println!("{}", leftpad::leftpad(s, n));</span>
                        <span class="fragment" data-fragment-index="1">}</span>
                </code></pre>
                </div>
                <pre class="fragment"><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo run -- foo 5</span>
                    <span class="fragment">
                       Finished dev [unoptimized + debuginfo] target(s) in 0.04s
                        Running `target/debug/leftpad foo 5`
                    &nbsp;&nbsp;foo
                    </span>
                </code></pre>
            </section>
            <section>
                <p>Creating a code example</p>
                <pre class="fragment"><code class="rust" data-trim>
                /// examples/leftpad_ex.rs
                extern crate leftpad;

                use leftpad::leftpad;

                fn main() {
                    println!("{}", leftpad("foo", 5));
                }
                </code></pre>
                <pre class="fragment"><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo run --examples leftpad_ex</span>
                    <span class="fragment">
                     Compiling leftpad v0.1.0 (/Users/jakubjagusztyn/Documents/cargo-playground/leftpad)
                      Finished dev [unoptimized + debuginfo] target(s) in 0.41s
                      Running `target/debug/examples/leftpad_ex`
                    &nbsp;&nbsp;foo
                    </span>
                </code></pre>


            </section>
            <section>
                <p><code>cargo run</code> summary</p>
                <ul>
                    <li class="fragment">If there's only one executable, it will be ran</li>
                    <li class="fragment">Otherwise, use <code data-noescape=>--bin &lt;name></code></li>
                    <li class="fragment"><code>--example &lt;name></code> to run <code>examples/&lt;name></code></li>
                    <li class="fragment">Runs unoptimized code by default</li>
                    <li class="fragment">CLI args: <code>cargo run -- arg1 arg2</code></li>
                </ul>
            </section>

        </section>
        <section>
            <section>
                <p>Time to test!</p>
            </section>
            <section>
                <p>First, let's write some tests...</p>
                <pre><code class="rust" data-trim data-noescape>
                    <span class="fragment" data-fragment-index="1">/// src/lib.rs</span>
                    <span class="fragment" data-fragment-index="1"></span>
                    <span class="fragment" data-fragment-index="2">#[cfg(test)]</span>
                    <span class="fragment" data-fragment-index="2">mod tests {</span>
                    <span class="fragment" data-fragment-index="3">    use super::leftpad;</span>
                    <span class="fragment" data-fragment-index="4">    #[test]</span>
                    <span class="fragment" data-fragment-index="4">    fn expanded() { assert_eq!(leftpad("foo", 5), "   foo"); }</span>
                    <span class="fragment" data-fragment-index="5">    #[test]</span>
                    <span class="fragment" data-fragment-index="5">    fn unchanged() { assert_eq!(leftpad("foo", 1), "foo"); }</span>
                    <span class="fragment" data-fragment-index="6">    #[test]</span>
                    <span class="fragment" data-fragment-index="6">    #[ignore]</span>
                    <span class="fragment" data-fragment-index="6">    fn large() {</span>
                    <span class="fragment" data-fragment-index="6">        let padded = leftpad("foo", 50_000);</span>
                    <span class="fragment" data-fragment-index="6">        assert_eq!(padded.chars().count(), 50_000);</span>
                    <span class="fragment" data-fragment-index="6">    }</span>
                    <span class="fragment" data-fragment-index="2">}</span>
                </code></pre>
            </section>
            <section>
                <p>...and run them with <code>cargo test</code></p>
                <pre><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo test</span>
                    <span class="fragment">
                    running 3 tests
                    test tests::large ... ignored
                    test tests::unchanged ... ok
                    test tests::expanded ... FAILED

                    failures:

                    ---- tests::expanded stdout ----
                    thread 'tests::expanded' panicked at 'assertion failed: `(left == right)`
                      left: `"  foo"`,
                     right: `"   foo"`', src/lib.rs:32:9
                    note: Run with `RUST_BACKTRACE=1` for a backtrace.

                    failures:
                        tests::expanded

                    test result: FAILED. 1 passed; 1 failed; 1 ignored; 0 measured; 0 filtered out
                    </span>
                </code></pre>
            </section>
            <section>
                <p>Use <code>cargo test &lt;s></code> to filter tests by name</p>
                <pre><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo test unc</span>
                    <span class="fragment">
                        running 1 test
                        test tests::unchanged ... ok
                    </span>
                </code></pre>
            </section>
            <section>
                <p>Running <code>#[ignored]</code> tests</p>
                <pre><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo test -- --ignored</span>
                    <span class="fragment">
                        running 1 test
                        test tests::large ... ok
                    </span>
                </code></pre>
            </section>
            <section>
                <p><code>cargo test</code></p>
                <ul>
                    <li class="fragment">By default all non-ignored tests are executed</li>
                    <li class="fragment">Example gets compiled too</li>
                    <li class="fragment">Even code snippets in doc comments are executed!</li>
                    <li class="fragment"><code>println!</code>s are only printed if the test fails</li>
                    <li class="fragment">Use <code>--nocapture</code> to prevent that</li>
                    <li class="fragment">Use <code>--test-threads=&lt;N></code> to control parallelism</li>
                    <li class="fragment">Pass options to test binary - not to <code>cargo</code>(after<code>--</code>)</li>
                </ul>
            </section>
        </section>
        <section>
            <section>
                <p>Okay, our library seems to work, but what's the performance?</p>
                <p class="fragment">We could use <code>cargo bench</code> to find out</p>
            </section>
            <section>
                <p>Writing a benchmark</p>
                <pre><code class="rust" data-trim data-noescape>
                <span class="aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa">/// benches/my_benchmark.rs</span>
                <span class="aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"></span>
                <span class="fragment" data-fragment-index="2">#![feature(test)]</span>
                <span class="fragment" data-fragment-index="2">extern crate test;</span>
                <span class="fragment" data-fragment-index="3">extern crate leftpad;</span>
                <span class="fragment" data-fragment-index="3"></span>
                <span class="fragment" data-fragment-index="4">use leftpad::leftpad;</span>
                <span class="fragment" data-fragment-index="4">use test::Bencher;</span>
                <span class="fragment" data-fragment-index="5"></span>
                <span class="fragment" data-fragment-index="5">#[bench]</span>
                <span class="fragment" data-fragment-index="5">fn len_100(b: &mut Bencher) {</span>
                <span class="fragment" data-fragment-index="6">   b.iter(|| leftpad("", 100));</span>
                <span class="fragment" data-fragment-index="5">}</span>
                <span class="fragment" data-fragment-index="7 ">#[bench]</span>
                <span class="fragment" data-fragment-index="7 ">fn len_10_000(b: &mut Bencher) {</span>
                <span class="fragment" data-fragment-index="7 ">   b.iter(|| leftpad("", 10_000));</span>
                <span class="fragment" data-fragment-index="7 ">}</span>
            </code></pre>
            </section>
            <section>
                <p>Running a benchmark</p>
            <pre><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo bench</span>
                    <span class="fragment">
                    error[E0554]: #![feature] may not be used on the stable release channel
                    --> benches/my_benchmark.rs:1:1
                      |
                    1 | #![feature(test)]
                      | ^^^^^^^^^^^^^^^^^
                    </span>
                </code></pre>
                <p class="fragment">Unfortunately, benchmarking is not yet in stable stdlib</p>
                <p class="fragment">So what can we do?</p>
            </section>
            <section>
                <h2>Use nightly!</h2>
            </section>
            <section>
                <p>Running a benchmark(with nightly)</p>
            <pre><code class="no-highlight" data-trim data-noescape>
                > <span class="fragment">rustup install nightly</span>
                <span class="fragment">.</span><span class="fragment">.</span><span class="fragment">.</span>
                <span class="fragment">nightly-x86_64-apple-darwin updated - rustc 1.32.0-nightly (13c943992 2018-11-18)
                > </span><span class="fragment">cargo +nightly bench</span><span class="fragment"> # or `rustup default nightly`</span><span class="fragment">
                running 2 tests
                test len_100    ... bench:       4,526 ns/iter (+/- 684)
                test len_10_000 ... bench:  25,367,409 ns/iter (+/- 687,346)</span>
            </code></pre>
            </section>
            <section>
                <p>Can we do better?</p>
                <p class="fragment" data-fragment-index="0">Let's try!</p>
                <pre><code data-trim class="rust" data-noescape>
                    <span class="fragment" data-fragment-index="1">pub fn leftpad(s: &str, to_len: usize) -> String {</span>
                    <span class="fragment" data-fragment-index="2">    format!("{:>1$}", s, to_len)</span>
                    <span class="fragment" data-fragment-index="1">}</span>
                </code></pre>
                <pre class="fragment"><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo +nightly bench</span><span class="fragment">
                    running 2 tests
                    test len_100    ... bench:       1,417 ns/iter (+/- 157)
                    test len_10_000 ... bench:      73,030 ns/iter (+/- 3,822)</span>
                </code></pre>
                <p class="fragment">Performance improved! Hooray!</p>
            </section>
        </section>
        <section>
            <section>
                <p>We're now ready to share our code</p>
            </section>
            <section>
                <p>We can simply push it to some web-hosted git repository...</p>
                <pre class="fragment"><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">git remote add origin git@github.com:JJag/leftpad-rs.git
                    > </span><span class="fragment">git push origin master</span>
                </code></pre>
                <pre class="fragment"><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo install --git https://github.com/JJag/leftpad-rs</span>
                    <span class="fragment">
                     Updating git repository `https://github.com/JJag/leftpad-rs`
                     Installing leftpad v0.1.0 (https://github.com/JJag/leftpad-rs#d70102dc)
                      Compiling leftpad v0.1.0 (https://github.com/JJag/leftpad-rs#d70102dc)
                       Finished release [optimized] target(s) in 1.41s
                     Installing /Users/jakubjagusztyn/.cargo/bin/leftpad
                    > </span><span class="fragment">leftpad foo 10</span>
                    <span class="fragment">       foo</span>
                </code></pre>
            </section>
            <section>
                <p>... or we can publish to <a href="crates.io">crates.io</a></p>
                <ul>
                    <li class="fragment">As simple as typing <code>cargo publish</code><span class="fragment">, but...</span></li>
                    <li class="fragment">Need account on crates.io</li>
                    <li class="fragment">Requires specifying some metadata(license, etc)</li>
                    <li class="fragment">Cannot be unpublished</li>
                </ul>
            </section>
            <section>
                <p>Publishing your code</p>
                <ul>
                    <li class="fragment">For small experimental projects publishing to git is often enough</li>
                    <li class="fragment">But if your crate is meant to be used widely, push to crates.io</li>
                    <li class="fragment">Custom registries are supported, but this feature is still unstable</li>
                </ul>
            </section>
        </section>
        <section>
            <p>Hooray! We published our library/application <span class="fragment">(kind of)</span></p>
        </section>
        <section>
            <section>
                <p>Managing project's dependencies</p>
            </section>
            <section>
                <p>Adding dependencies</p>
                <pre><code class="toml" data-trim data-noescape>
                    [package]
                    name = "rightpad"
                    version = "0.1.0"
                    authors = ["Jakub Jagusztyn &lt;jakub.jagusztyn@g mail.com>"]

                    [dependencies]
                    <span class="fragment">rand = "0.6"</span>
                    <span class="fragment">postgres = "^1"</span>
                    <span class="fragment">bitflags = ">2, <2.5.4"</span>
                    <span class="fragment">log = { version = "*", optional = true }</span>
                    <span class="fragment">leftpad = { git = "https://github.com/JJag/github" }</span>
                    <span class="fragment">
                    [dev-dependencies]
                    criterion = "0.2"
                    </span><span class="fragment">
                    [build-dependencies]
                    cc = "=1.0.1"
                    </span>
                </code></pre>
            </section>
            <section>
                <p>Semantic Versioning</p>
                <p><code data-noescape="">
                    <span class="fragment highlight-current-red" data-fragment-index="1">MAJOR</span>.<span
                        class="fragment highlight-current-blue" data-fragment-index="2">MINOR</span>.<span
                        class="fragment highlight-current-green" data-fragment-index="3">PATCH</span></code></p>
                <ul>
                    <li><span class="fragment highlight-current-red" data-fragment-index="1">MAJOR</span> - <b>incompatible</b>
                        API changes
                    </li>
                    <li><span class="fragment highlight-current-blue" data-fragment-index="2">MINOR</span> -
                        backward-compatible API changes
                    </li>
                    <li><span class="fragment highlight-current-green" data-fragment-index="3">PATCH</span> -
                        backwards-compatible bugfixes
                    </li>
                </ul>
            </section>
            <section>
                What do these funny characters before version mean?
            </section>
            <section>
                <p>Caret (<code>^</code>) or no prefix</p>
                <pre><code data-noescape data-trim>
                        <span class="fragment">1.2.3 OR ^1.2.3    # [1.2.3, 2.0.0)</span>
                        <span class="fragment">1.2 OR ^1.2        # [1.2.0, 2.0.0)</span>
                        <span class="fragment">1 OR ^1            # [1.0.0, 2.0.0)</span>
                    </code></pre>
                </ul>
            </section>
            <section>
                <p>Tilde (<code>~</code>)</p>
                <pre><code data-noescape data-trim>
                    <span class="fragment">~1.2.3    # [1.2.3, 1.3.0)</span>
                    <span class="fragment">~1.2      # [1.2.0, 1.3.0)</span>
                    <span class="fragment">~1        # [1.0.0, 2.0.0)</span>
                </code></pre>
            </section>
            <section>
                <p>(In)equality symbols (<code>=, <, >, <=, >=</code>)</p>
                <pre><code data-noescape data-trim>
                    <span class="fragment">>=1.0.1,<=1.2.0 # [1.0.1, 1.3.0)</span>
                    <span class="fragment">=1.2.3     # exactly 1.2.3</span>
                </code></pre>
            </section>
            <section>
                <p>Wildcard (<code>*</code>)</p>
                <pre><code data-noescape data-trim>
                    <span class="fragment">*        # any version</span>
                    <span class="fragment">1.*      # [1.0.0, 2.0.0)</span>
                    <span class="fragment">1.2.*    # [1.2.0, 1.3.0)</span>
                </code></pre>
            </section>
            <section>
                <p>Upadating dependencies</p>
            </section>
            <section>
                <p>What is Cargo.lock?</p>
                <pre class="toml fragment"><code data-noescape data-trim>
                    /// Cargo.toml
                    [dependencies]
                    log = "*"
                </code></pre>
                <pre class="toml fragment"><code data-noescape data-trim>
                    [[package]]
                    name = "cfg-if"
                    version = "0.1.6"
                    source = "registry+https://github.com/rust-lang/crates.io-index"

                    [[package]]
                    name = "leftpad"
                    version = "0.1.0"
                    dependencies = [
                     "log 0.4.5 (registry+https://github.com/rust-lang/crates.io-index)",
                    ]

                    [[package]]
                    name = "log"
                    version = "0.4.5"
                    source = "registry+https://github.com/rust-lang/crates.io-index"
                    dependencies = [
                     "cfg-if 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)",
                    ]

                    [metadata]
                    "checksum cfg-if 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)" = "082bb9b28e00d3c9d39cc03e64ce4cea0f1bb9b3fde493f0cbc008472d22bdf4"
                    "checksum log 0.4.5 (registry+https://github.com/rust-lang/crates.io-index)" = "c84ec4b527950aa83a329754b01dbe3f58361d1c5efacd1f6d68c494d08a17c6"
                </code></pre>

            </section>
            <section>
                <p>Updating dependencies</p>
                <ul>
                    <li class="fragment">Exact versions of our dependencies are kept in Cargo.lock</li>
                    <li class="fragment">Should I <code>.gitignore</code> Cargo.lock?</li>
                    <li class="fragment">Use <code>cargo update</code> to update dependencies</li>
                </ul>
                <pre class="fragment"><code class="no-highlight" data-trim data-noescape>
                > <span class="fragment">cargo update</span>
                <span class="fragment">
                Updating crates.io index
                Updating log v0.4.5 -> v0.4.6
                </span>
                </code></pre>
            </section>
            <section>
                <p>Git dependencies</p>
                <pre><code class="toml" data-trim data-noescape>
                    [dependencies]
                    <span class="fragment">foo = { git = "https://github.com/JJag/foo" }</span>
                    <span class="fragment">foo = { git = "https://github.com/JJag/foo", branch = "develop" }</span>
                    <span class="fragment">foo = { git = "https://github.com/JJag/foo", rev = "4be967c" }</span>
                </code></pre>
            </section>
            <section>
                <p>Path dependencies</p>
                <pre><code class="toml" data-trim data-noescape>
                    [dependencies]
                    <span class="fragment">foo = { path = "some/subdirectory" }</span>
                    <span class="fragment">foo = { path = "../sibling" }</span>
                    <span class="fragment">foo = { path = "/absolute/path" }</span>
                </code></pre>
            </section>
            <section>
                <p>Development dependencies</p>
                <pre><code class="toml" data-trim data-noescape>
                [dev-dependencies]
                <span class=fragment">foo = "*"</span>
                </code></pre>
                <p class="fragment">Available in tests, benchmarks and examples</p>
            </section>
            <section>
                <p>Build dependencies</p>
                <pre><code class="toml" data-trim data-noescape>
                [build-dependencies]
                <span class=fragment">foo = "*"</span>
                </code></pre>
                <p class="fragment">Only available in build scripts</p>
            </section>
        </section>
        <section>
            <section>
                <p>Conditional compilation</p>
            </section>
            <section>
                <p>Feature flags can be used to enable conditional compilation</p>
                <ul>
                </ul>
            </section>
            <section>
                <p>Declaring features</p>
                <pre><code class="toml" data-noescape data-trim>
                    ### Cargo.toml
                    [dependencies]
                    log = { version = "*", optional = true }
                    postgres = "*"

                    [features]
                    logging = ["log", "postgres/log"] # aggregates multiple features and forwards feature to dependency
                    foo = []                          # declaring the name to use in `cfg` macro and attribute
                    default = []                      # features in this array will be enabled by defualt
                                                      # unless build with `--no-default-features`
                </code></pre>
            </section>
            <section>
                <p>Feature-dependant code</p>
                <pre><code class="rust" data-trim>
                    #cfg[feature="foo"]
                    pub fn foo() {
                        println!("foo");
                    }
                </code></pre>
                <pre><code class="rust" data-trim>
                    pub fn info(msg: $str) {
                        if cfg!(feature = "log") {
                            log::info(msg);
                        }
                    }
                </code></pre>
            </section>
            <section>
                <p>Enabling features</p>
                <pre><code class="toml" data-noescape data-trim>
                > cargo build --feature logging
                </code></pre>
            </section>
            <section>
                <p>Features summary</p>
                <ul>
                    <li class="fragment">Dependencies can be <code>optional</code></li>
                    <li class="fragment">Code can be marked with <code>#[cfg(feature = "foo")]</code> attribute</li>
                    <li class="fragment"><code>cfg!(feature = "foo")</code> macro can be used in <code>if</code> statements</li>
                    <li class="fragment">Should be used to enable optional <i>features</i> in application</li>
                    <li class="fragment">Usually should be avoided in libraries</li>
                </ul>
            </section>
        </section>
        <section>
            <section>
                <p>Build scripts</p>
            </section>
            <section>
                <p>Sometimes <code>cargo build</code> is not enough</p>
                <ul>
                    <li class="fragment">Generating Rust code</li>
                    <li class="fragment">Compiling bundled C code</li>
                    <li class="fragment">Locating native libraries</li>
                </ul>
            </section>
                <section>
                    <p><code>build.rs</code> to the rescue</p>
                <ul>
                    <li class="fragment">Gets called before compiling our code</li>
                    <li class="fragment">Can pass flags settings to cargo via <code>println!</code></li>
                </ul>
            </section>
            <section>
                <p>Demo: compiling C code</p>
                <pre><code class="fragment c" data-trim>
                /// src/foo.c
                int foo() {
                    return 5;
                }</code></pre>
                <pre><code class="fragment rust" data-trim>
                /// src/main.rs
                extern {
                    fn foo() -> i32;
                }

                fn main() {
                    let x = unsafe { foo() };
                    println!("{}", x);
                }</code></pre>
            </section>
            <section>
                <pre><code class="fragment toml" data-trim>
                # Cargo.toml
                [build-dependencies]
                cc = "1"</code></pre>
                <pre><code class="fragment rust" data-trim>
                /// build.rs
                extern crate cc;

                fn main() {
                    cc::Build::new()
                        .file("src/foo.c")
                        .compile("foo");
                }</code></pre>
            </section>
            <section>
                <pre><code class="fragment rust" data-trim data-noescape="">
                > <span class="fragment">cargo build -vv</span>
                <span class="fragment">(...)</span>
                <span class="fragment">running: "cc" (...)
                    "-o" "(...)/example/target/debug/build/example-8b4e72261d5655d7/out/src/foo.o"
                    "-c" "src/foo.c"</span>
                <span class="fragment">(...)</span>
                <span class="fragment">cargo:rustc-link-lib=static=foo</span>
                <span class="fragment">cargo:rustc-link-search=native=(...)/example/target/debug/build/example-8b4e72261d5655d7/out</span>
                <span class="fragment">(...)</span>
                <span class="fragment">> </span> <span class="fragment">cargo run</span>
                <span class="fragment">(...)</span>
                <span class="fragment">5</span>
                </code></pre>
            </section>
            <section>
                <p>Build scripts summary</p>
                <ul>
                    <li class="fragment">Commonly used in wrappers for C libraries</li>
                    <li class="fragment">Configures cargo behaviours via <code>println!</code></li>
                    <li class="fragment">Can provide compile time information to our crate(git SHA for example)</li>
                    <li class="fragment">Can access only <code>[build-dependencies]</code></li>
                </ul>
            </section>
        </section>
        <section>
            <section>
                <p>Workspaces</p>
            </section>
            <section>
                <p>Problem</p>
                <ul>
                    <li class="fragment">Our project got large</li>
                    <li class="fragment">We decided to split it to multiple crates</li>
                    <li class="fragment">There are many shared dependencies</li>
                    <li class="fragment">You would like to compile/test them all at once</li>
                </ul>
            </section>
            <section>
                <p>Solution: workspaces</p>
                <pre><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cargo new large-project
                    > </span><span class="fragment">cargo new large-project/a
                    > </span><span class="fragment">cargo new large-project/b</span>
                </code></pre>
                <pre class="fragment"><code class="toml" data-trim data-noescape>
                    /// large-project/Cargo.toml
                    # [package] is not required if root only aggregates projects
                    [workspace] # We have to declare root to be workspace
                    members = ["a", "b"]
                </code></pre>
            </section>
            <section>
                <pre class="fragment"><code class="toml" data-trim data-noescape>
                    /// large-project/a/Cargo.toml
                    [package]
                    name = "a"
                    [dependencies]
                    log = "0.4"
                </code></pre>
                <pre class="fragment"><code class="toml" data-trim data-noescape>
                    /// large-project/a/Cargo.toml
                    [package]
                    name = "a"
                    [dependencies]
                    log = "0.4"
                </code></pre>
            </section>
            <section>
                <pre><code class="no-highlight" data-trim data-noescape>
                    > <span class="fragment">cd large-project
                    > </span><span class="fragment">cargo build
                       Compiling cfg-if v0.1.6
                       Compiling log v0.4.6
                       Compiling b v0.1.0 (.../large-project/b)
                       Compiling a v0.1.0 (.../large-project/a)
                        Finished dev [unoptimized + debuginfo] target(s) in 1.05s
                    > </span><span class="fragment">tree .</span><span class="fragment">
                    .
                    ├── Cargo.lock      # only one lockfile
                    ├── Cargo.toml
                    ├── a
                    │   ├── Cargo.toml
                    │   └── src
                    │       └── main.rs
                    ├── b
                    │   ├── Cargo.toml
                    │   └── src
                    │       └── main.rs
                    └── target          # only one target directory
                         └─ ...
                    </span>
                </code></pre>
            </section>
            <section>
                <p>Workspaces summary</p>
                <ul>
                    <li class="fragment">Group related crates together</li>
                    <li class="fragment">Allow reuse of dependencies</li>
                    <li class="fragment">Easier building for multiple creates</li>
                    <li class="fragment"><code>-p NAME</code> option can be used to build single crate</li>
                    <li class="fragment"><code>publish</code> still have to be invoked separately</li>
                </ul>
            </section>

        </section>
        <section>
            <section>
                <p>Configuring cargo</p>
            </section>
            <section>
                <ul>
                   <li class="fragment">Annoyed by cargo defaults?</li>
                   <li class="fragment">You don't use git?</li>
                   <li class="fragment">Want to use crates.rs instead of crates.io?</li>
                   <li class="fragment">Tired of typing <code>run --release</code>?</li>
                </ul>
            </section>
            <section>
                <h2>We have a solution for you!</h2>
                <p class="fragment"><code>.cargo/config</code></p>
            </section>
            <section>
                <p>Example config</p>
                <pre><code data-trim data-noescape class="toml">
                    <span class="fragment">
                        [cargo-new]
                        vcs = "none"
                    </span><span class="fragment">
                        [registry]
                        index = "https://crates.rs"
                    </span><span class="fragment">
                        [http]
                        proxy = "my-proxy:1234"
                    </span><span class="fragment">
                        [target."x86_64-apple-darwin"]
                        rustflags = ["--some-mac-only-flag"]
                    </span><span class="fragment">
                        [build]
                        jobs = 1
                    </span><span class="fragment">
                        [term]
                        verbose = true
                    </span><span class="fragment">
                        [alias]
                        rr = "run --release"
                </span>
                </code></pre>
            </section>
            <section>
                <p><code>.cargo/config</code> summary</p>
                <ul>
                    <li class="fragment">Allows to change cargo defualts</li>
                    <li class="fragment">Can be defined per project</li>
                    <li class="fragment">And globally in <code>~/.cargo/config</code></li>
                    <li class="fragment">You rarely want to touch this</li>
                    <li class="fragment">Configs can be overriden by env variables. For example
                    <code>CARGO_BUILD_JOBS=16</code></li>
                </ul>

            </section>

        </section>
        <section>
            <section>
                <p>Handful of useful tools</p>
            </section>
            <section>
                <p><code>cargo doc</code></p>
                <ul>
                    <li class="fragment">Generates HTML docs using <code>rustdoc</code></li>
                    <li class="fragment">Docs are generated for dependencies too!</li>
                    <li class="fragment">Use <code>--open</code> to open docs in your browser</li>
                    <li class="fragment">Offline documentation for our version of dependencies!</li>
                </ul>
            </section>
            <section>
                <p><code>cargo fix</code></p>
                <ul>
                    <li class="fragment">Fixes compilation warnings automatically</li>
                    <li class="fragment">Keep in mind it can skip conditionally compiled code</li>
                    <li class="fragment">Use <code>--all-features</code> to prevent skipping</li>
                </ul>
            </section>
            <section>
                <p><code>cargo fmt</code></p>
                <ul>
                    <li class="fragment">Formats your code automatically</li>
                    <li class="fragment">Not installed by default</li>
                    <li class="fragment"><code>rustup component add rustfmt-preview</code> to install</li>
                    <li class="fragment"><code>cargo fmt -- --check</code> - great for CI</li>
                    <li class="fragment"><a href="https://github.com/rust-lang-nursery/rustfmt/blob/master/Configurations.md">Configurable</a></li>
                </ul>
            </section>
            <section>
                <p><code>cargo clippy</code></p>
                <ul>
                    <li class="fragment">Linter for rust</li>
                    <li class="fragment"><a href="https://rust-lang-nursery.github.io/rust-clippy/master/index.html">Almost 300 lints</a></li>
                    <li class="fragment">Not installed by default</li>
                    <li class="fragment"><code>rustup component add clippy-preview</code> to install</li>
                </ul>
            </section>
            <section>
                <p>Example lint</p>
                <pre><code class="fragment rust" data-trim>
                    impl Sub&lt;Vec3> for Vec3 {
                        type Output = Vec3;
                        fn sub(self, other: Vec3) -> Vec3 {
                            let x = self.x + other.x;
                            let y = self.y + other.y;
                            let z = self.z + other.z;
                            Vec3 { x, y, z }
                        }
                    }</code></pre>
                <pre><code class="fragment no-highlight">
error: Suspicious use of binary operator in `Sub` impl
  --> src/vec3.rs:90:24
   |
90 |         let x = self.x + other.x;
   |                        ^
   = note: #[deny(clippy::suspicious_arithmetic_impl)] on by default
                </code></pre>
            </section>
            <section>
                <h4>Install these once you get home!</h4>
            </section>
            <section>
                <p>That's all, Folks</p>
                <p class="fragment">Any questions?</p>
            </section>
            <section></section>
        </section>

    </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
</script>
</body>
</html>
